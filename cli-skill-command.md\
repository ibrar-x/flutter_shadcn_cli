# Flutter Shadcn CLI - How to Implement `install-skill` Command

Complete implementation guide for your CLI tool.

---

## üéØ Overview

You need to implement the `install-skill` command that:

1. **Reads** skill metadata from `skill.json` in your registry
2. **Validates** skill compatibility with user's environment
3. **Copies** skill files to AI model folders (`.claude/`, `.gpt4/`, etc.)
4. **Manages** installed skills (list, update, remove)

---

## üìÅ Your Registry Structure

First, set up your registry with skills:

```
flutter_shadcn_registry/
‚îú‚îÄ‚îÄ skills/
‚îÇ   ‚îî‚îÄ‚îÄ flutter-shadcn-ui/
‚îÇ       ‚îú‚îÄ‚îÄ skill.json                  ‚Üê Manifest (your CLI reads)
‚îÇ       ‚îú‚îÄ‚îÄ skill.yaml                  ‚Üê Manifest (your CLI reads)
‚îÇ       ‚îú‚îÄ‚îÄ SKILL.md                    ‚Üê Skill file (gets copied)
‚îÇ       ‚îú‚îÄ‚îÄ INSTALLATION.md             ‚Üê Skill file (gets copied)
‚îÇ       ‚îî‚îÄ‚îÄ references/
‚îÇ           ‚îú‚îÄ‚îÄ commands.md             ‚Üê Skill file (gets copied)
‚îÇ           ‚îî‚îÄ‚îÄ examples.md             ‚Üê Skill file (gets copied)
‚îÇ
‚îî‚îÄ‚îÄ (other registry files)
```

---

## üîß Step 1: Parse skill.json in Your CLI

### Dart Implementation

```dart
import 'dart:convert';
import 'dart:io';

class SkillManifest {
  final String id;
  final String name;
  final String version;
  final List<String> compatibleModels;
  final String requiredCliVersion;
  final Map<String, dynamic> files;
  final List<String> capabilities;

  SkillManifest({
    required this.id,
    required this.name,
    required this.version,
    required this.compatibleModels,
    required this.requiredCliVersion,
    required this.files,
    required this.capabilities,
  });

  // Parse from JSON
  factory SkillManifest.fromJson(Map<String, dynamic> json) {
    return SkillManifest(
      id: json['id'] as String,
      name: json['name'] as String,
      version: json['version'] as String,
      compatibleModels: List<String>.from(
        json['compatibility']['ai_models'] as List
      ),
      requiredCliVersion: json['compatibility']['requirements']['cli_version'] as String,
      files: json['files'] as Map<String, dynamic>,
      capabilities: List<String>.from(
        json['capabilities'] as List? ?? []
      ),
    );
  }

  // Load from file
  static Future<SkillManifest> load(String skillId, String registryPath) async {
    final manifestFile = File('$registryPath/skills/$skillId/skill.json');
    
    if (!await manifestFile.exists()) {
      throw Exception('Skill not found: $skillId');
    }

    final json = jsonDecode(await manifestFile.readAsString());
    return SkillManifest.fromJson(json);
  }
}
```

### Usage

```dart
// Load a skill manifest
final manifest = await SkillManifest.load('flutter-shadcn-ui', './registry');

print('Skill: ${manifest.name} (v${manifest.version})');
print('Compatible models: ${manifest.compatibleModels.join(", ")}');
print('Capabilities: ${manifest.capabilities.join(", ")}');
```

---

## üîç Step 2: Validate Compatibility

Before installing, check if the skill is compatible:

```dart
class SkillValidator {
  /// Check if skill is compatible with current environment
  static ValidationResult validate(
    SkillManifest manifest, {
    required String currentCliVersion,
    required String targetModel,
  }) {
    final errors = <String>[];
    final warnings = <String>[];

    // Check CLI version
    if (!_isVersionCompatible(currentCliVersion, manifest.requiredCliVersion)) {
      errors.add(
        'Skill requires CLI version ${manifest.requiredCliVersion}, '
        'but you have $currentCliVersion'
      );
    }

    // Check AI model compatibility
    if (!manifest.compatibleModels.contains(targetModel)) {
      errors.add(
        'Skill is not compatible with $targetModel. '
        'Supports: ${manifest.compatibleModels.join(", ")}'
      );
    }

    // Check folder exists
    if (!Directory('.$targetModel').existsSync()) {
      warnings.add(
        'AI model folder .$targetModel not found. '
        'Create it first: mkdir -p .$targetModel'
      );
    }

    return ValidationResult(
      isValid: errors.isEmpty,
      errors: errors,
      warnings: warnings,
    );
  }

  /// Parse semantic version and compare
  static bool _isVersionCompatible(String current, String required) {
    // Simple implementation - handle "1.0.0+" format
    if (required.endsWith('+')) {
      final minVersion = required.replaceAll('+', '');
      return current.compareTo(minVersion) >= 0;
    }
    return current == required;
  }
}

class ValidationResult {
  final bool isValid;
  final List<String> errors;
  final List<String> warnings;

  ValidationResult({
    required this.isValid,
    required this.errors,
    required this.warnings,
  });
}
```

### Usage

```dart
final result = SkillValidator.validate(
  manifest,
  currentCliVersion: '1.0.0',
  targetModel: 'claude',
);

if (!result.isValid) {
  for (var error in result.errors) {
    print('ERROR: $error');
  }
  exit(1);
}

for (var warning in result.warnings) {
  print('WARNING: $warning');
}
```

---

## üìã Step 3: Get Files to Copy

Parse the manifest to know which files to install:

```dart
class SkillFileManager {
  /// Get list of files to copy based on manifest
  static List<String> getFilesToCopy(SkillManifest manifest) {
    final files = <String>[];

    // Get main file
    if (manifest.files['main'] != null) {
      files.add(manifest.files['main'] as String);
    }

    // Get installation file (if exists)
    if (manifest.files['installation'] != null) {
      files.add(manifest.files['installation'] as String);
    }

    // Get reference files
    if (manifest.files['references'] is Map) {
      final references = manifest.files['references'] as Map<String, dynamic>;
      for (var ref in references.values) {
        if (ref is String) {
          files.add(ref);
        }
      }
    }

    return files;
  }

  /// Get source path for a file
  static String getSourcePath(String skillId, String file, String registryPath) {
    return '$registryPath/skills/$skillId/$file';
  }

  /// Get destination path for a file
  static String getDestinationPath(String skillId, String file, String aiModel) {
    return '.$aiModel/$skillId/$file';
  }

  /// Verify all source files exist
  static Future<bool> verifySourceFiles(
    SkillManifest manifest,
    String registryPath,
  ) async {
    final files = getFilesToCopy(manifest);

    for (var file in files) {
      final source = getSourcePath(manifest.id, file, registryPath);
      if (!await File(source).exists()) {
        print('ERROR: Source file not found: $source');
        return false;
      }
    }

    return true;
  }
}
```

### Usage

```dart
final filesToCopy = SkillFileManager.getFilesToCopy(manifest);
print('Files to copy:');
for (var file in filesToCopy) {
  print('  - $file');
}

// Verify all source files exist
final verified = await SkillFileManager.verifySourceFiles(
  manifest,
  './registry',
);

if (!verified) {
  exit(1);
}
```

---

## üîÑ Step 4: Copy Files to AI Model Folder

```dart
class SkillInstaller {
  /// Install skill to target AI model
  static Future<void> installSkill({
    required SkillManifest manifest,
    required String targetModel,
    required String registryPath,
    required bool verbose,
  }) async {
    final filesToCopy = SkillFileManager.getFilesToCopy(manifest);
    
    if (verbose) {
      print('Installing skill: ${manifest.id} (v${manifest.version})');
      print('Target model: $targetModel');
      print('Files to copy: ${filesToCopy.length}');
    }

    try {
      // Step 1: Create destination directory
      final destDir = Directory('.$targetModel/${manifest.id}');
      await destDir.create(recursive: true);
      
      if (verbose) {
        print('‚úì Created directory: ${destDir.path}');
      }

      // Step 2: Copy each file
      for (var file in filesToCopy) {
        final source = SkillFileManager.getSourcePath(
          manifest.id,
          file,
          registryPath,
        );
        final destination = SkillFileManager.getDestinationPath(
          manifest.id,
          file,
          targetModel,
        );

        // Create subdirectories if needed
        final destFile = File(destination);
        await destFile.parent.create(recursive: true);

        // Copy the file
        await File(source).copy(destination);
        
        if (verbose) {
          print('‚úì Copied: $file');
        }
      }

      // Step 3: Save manifest for tracking
      await _saveInstalledManifest(manifest, targetModel);

      print('‚úì Skill installed successfully!');
      print('  Skill: ${manifest.name} (v${manifest.version})');
      print('  Location: .$targetModel/${manifest.id}/');
      print('  Files: ${filesToCopy.length}');

    } catch (e) {
      print('ERROR: Failed to install skill: $e');
      rethrow;
    }
  }

  /// Save manifest locally for tracking
  static Future<void> _saveInstalledManifest(
    SkillManifest manifest,
    String aiModel,
  ) async {
    final manifestFile = File(
      '.$aiModel/${manifest.id}/manifest.json'
    );

    final data = {
      'id': manifest.id,
      'name': manifest.name,
      'version': manifest.version,
      'installed_at': DateTime.now().toIso8601String(),
      'capabilities': manifest.capabilities,
    };

    await manifestFile.writeAsString(jsonEncode(data));
  }
}
```

### Usage

```dart
await SkillInstaller.installSkill(
  manifest: manifest,
  targetModel: 'claude',
  registryPath: './registry',
  verbose: true,
);
```

---

## üìä Step 5: List Installed Skills

```dart
class SkillLister {
  /// List installed skills for all AI models
  static Future<void> listInstalledSkills() async {
    final aiModels = ['.claude', '.gpt4', '.cursor', '.gemini'];
    
    bool foundAny = false;

    for (var model in aiModels) {
      final modelDir = Directory(model);
      if (!modelDir.existsSync()) continue;

      final skillDirs = modelDir
          .listSync()
          .whereType<Directory>()
          .toList();

      if (skillDirs.isEmpty) continue;

      print('\n=== $model ===');
      foundAny = true;

      for (var skillDir in skillDirs) {
        final manifestFile = File('${skillDir.path}/manifest.json');
        
        if (await manifestFile.exists()) {
          final manifest = jsonDecode(await manifestFile.readAsString());
          print(
            '  ‚Ä¢ ${manifest['name']} (v${manifest['version']})'
          );
          
          if (manifest['installed_at'] != null) {
            print(
              '    Installed: ${manifest['installed_at']}'
            );
          }
        }
      }
    }

    if (!foundAny) {
      print('No skills installed yet.');
      print('Run: flutter_shadcn install-skill --skill flutter-shadcn-ui');
    }
  }
}
```

### Usage

```dart
await SkillLister.listInstalledSkills();
```

**Output:**
```
=== .claude ===
  ‚Ä¢ Flutter Shadcn UI (v1.0.0)
    Installed: 2024-02-04T10:30:00.000Z

=== .cursor ===
  ‚Ä¢ Flutter Shadcn UI (v1.0.0)
    Installed: 2024-02-04T10:32:00.000Z
```

---

## üîç Step 6: Implement CLI Commands

```dart
import 'package:args/command_runner.dart';

class SkillCommand extends Command {
  @override
  final name = 'install-skill';
  
  @override
  final description = 'Install AI skills for component development';

  SkillCommand() {
    argParser.addOption(
      'skill',
      abbr: 's',
      help: 'Skill name to install (e.g., flutter-shadcn-ui)',
    );
    argParser.addOption(
      'model',
      abbr: 'm',
      help: 'AI model folder (.claude, .gpt4, .cursor, .gemini)',
      allowed: ['.claude', '.gpt4', '.cursor', '.gemini'],
    );
    argParser.addFlag(
      'list',
      help: 'List installed skills',
    );
    argParser.addFlag(
      'verbose',
      abbr: 'v',
      help: 'Show detailed output',
    );
  }

  @override
  Future<void> run() async {
    final verbose = argResults?['verbose'] as bool? ?? false;
    final registryPath = './registry'; // Or from config

    // List installed skills
    if (argResults?['list'] as bool? ?? false) {
      await SkillLister.listInstalledSkills();
      return;
    }

    // Install a skill
    final skillName = argResults?['skill'] as String?;
    final modelName = argResults?['model'] as String?;

    if (skillName == null || modelName == null) {
      print('Usage: flutter_shadcn install-skill --skill <name> --model <model>');
      print('  flutter_shadcn install-skill --skill flutter-shadcn-ui --model .claude');
      print('  flutter_shadcn install-skill --list');
      exit(1);
    }

    try {
      // Load manifest
      final manifest = await SkillManifest.load(skillName, registryPath);

      // Validate
      final validation = SkillValidator.validate(
        manifest,
        currentCliVersion: '1.0.0', // Get from your CLI version
        targetModel: modelName,
      );

      if (!validation.isValid) {
        for (var error in validation.errors) {
          print('ERROR: $error');
        }
        exit(1);
      }

      for (var warning in validation.warnings) {
        print('WARNING: $warning');
      }

      // Verify source files
      final verified = await SkillFileManager.verifySourceFiles(
        manifest,
        registryPath,
      );
      if (!verified) exit(1);

      // Install
      await SkillInstaller.installSkill(
        manifest: manifest,
        targetModel: modelName,
        registryPath: registryPath,
        verbose: verbose,
      );

    } catch (e) {
      print('ERROR: $e');
      exit(1);
    }
  }
}
```

---

## üöÄ Step 7: Add to Your CLI Main

```dart
void main(List<String> args) async {
  final runner = CommandRunner('flutter_shadcn', 'Flutter Shadcn CLI')
    ..addCommand(InitCommand())
    ..addCommand(AddCommand())
    ..addCommand(RemoveCommand())
    ..addCommand(DoctorCommand())
    ..addCommand(SkillCommand())  // ‚Üê Add this
    ..addCommand(ThemeCommand())
    // ... other commands
  ;

  try {
    await runner.run(args);
  } catch (e) {
    print('Error: $e');
    exit(1);
  }
}
```

---

## üìù Usage Examples

### Install skill to Claude

```bash
$ flutter_shadcn install-skill --skill flutter-shadcn-ui --model .claude
‚úì Skill installed successfully!
  Skill: Flutter Shadcn UI (v1.0.0)
  Location: .claude/flutter-shadcn-ui/
  Files: 6
```

### Install to multiple models

```bash
$ flutter_shadcn install-skill --skill flutter-shadcn-ui --model .claude
$ flutter_shadcn install-skill --skill flutter-shadcn-ui --model .gpt4
$ flutter_shadcn install-skill --skill flutter-shadcn-ui --model .cursor
```

### List installed skills

```bash
$ flutter_shadcn install-skill --list

=== .claude ===
  ‚Ä¢ Flutter Shadcn UI (v1.0.0)
    Installed: 2024-02-04T10:30:00.000Z

=== .gpt4 ===
  ‚Ä¢ Flutter Shadcn UI (v1.0.0)
    Installed: 2024-02-04T10:32:00.000Z
```

### Show verbose output

```bash
$ flutter_shadcn install-skill --skill flutter-shadcn-ui --model .claude --verbose
Installing skill: flutter-shadcn-ui (v1.0.0)
Target model: .claude
Files to copy: 6
‚úì Created directory: .claude/flutter-shadcn-ui
‚úì Copied: SKILL.md
‚úì Copied: INSTALLATION.md
‚úì Copied: references/commands.md
‚úì Copied: references/examples.md
‚úì Skill installed successfully!
```

---

## üîß Configuration (Optional)

Store registry path in config:

```dart
// In .shadcn/config.json
{
  "installPath": "lib/ui/shadcn",
  "sharedPath": "lib/ui/shadcn/shared",
  "theme": "modern-minimal",
  "registry": {
    "mode": "remote",
    "url": "https://registry.shadcn-flutter.com",
    "skillsPath": "./registry/skills"  // ‚Üê Local skills folder
  }
}
```

```dart
// In your CLI
class Config {
  final String skillsPath;
  
  Config({this.skillsPath = './registry/skills'});
  
  static Future<Config> load() async {
    final configFile = File('.shadcn/config.json');
    if (!await configFile.exists()) {
      return Config();
    }
    
    final json = jsonDecode(await configFile.readAsString());
    return Config(
      skillsPath: json['registry']?['skillsPath'] ?? './registry/skills',
    );
  }
}
```

---

## ‚úÖ Complete Implementation Checklist

- [ ] Create `SkillManifest` class to parse skill.json
- [ ] Create `SkillValidator` class to validate compatibility
- [ ] Create `SkillFileManager` class to handle file operations
- [ ] Create `SkillInstaller` class to install skills
- [ ] Create `SkillLister` class to list installed skills
- [ ] Implement `SkillCommand` CLI command
- [ ] Add `SkillCommand` to main CommandRunner
- [ ] Test installation: `flutter_shadcn install-skill --skill flutter-shadcn-ui --model .claude`
- [ ] Test listing: `flutter_shadcn install-skill --list`
- [ ] Test verbose output: `flutter_shadcn install-skill --skill flutter-shadcn-ui --model .claude --verbose`
- [ ] Test error handling (invalid skill, unsupported model, etc.)

---

## üéØ Summary

Your `install-skill` command should:

1. **Parse** skill.json to get metadata
2. **Validate** compatibility (version, AI models)
3. **Get** list of files to copy (from manifest)
4. **Create** destination directory
5. **Copy** skill files (.md files)
6. **Save** manifest locally for tracking
7. **Report** success/failure to user

That's it! Your CLI can now manage AI skills! üöÄ

---